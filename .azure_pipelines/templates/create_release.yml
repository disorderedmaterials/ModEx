steps:
  - task: DownloadBuildArtifacts@0
    inputs:
      buildType: 'current'
      specificBuildWithTriggering: true
      downloadType: 'single'
      artifactName: 'linux-artifacts'
    displayName: 'Download Linux Artifacts'
  - task: DownloadBuildArtifacts@0
    inputs:
      buildType: 'current'
      specificBuildWithTriggering: true
      downloadType: 'single'
      artifactName: 'osx-artifacts'
    displayName: 'Download OSX Artifacts'
  - bash: |
      VERSION=`grep "#define MODEX_VERSION" version.h | sed "s/.*\"\(.*\)\"/\1/g"`
      git clone https://github.com/disorderedmaterials/scripts.git
      sed -i  -e 's/trisyoungs/jswift-stfc/g' scripts/update-release
      sed -i  -e 's/tristan.youngs/jared.swift/g' scripts/update-release
      mkdir ModEx-$VERSION-osx
      mv $(System.ArtifactsDirectory)/osx-artifacts/* ModEx-$VERSION-osx/
      mkdir ModEx-$VERSION-linux
      mv $(System.ArtifactsDirectory)/linux-artifacts/* ModEx-$VERSION-linux/
      ./scripts/update-release -r disorderedmaterials/modex -t ${VERSION} -n "${VERSION}" -f ReleaseNotes.md ModEx-$VERSION-osx ModEx-$VERSION-linux
    env:
      GITHUB_TOKEN: $(REPO_SECRET)
    displayName: 'Create Versioned Release (GitHub)'